/* ===========================
   Scions of FarStar - CSS
   =========================== */

/* Fate Core Font Integration */
@font-face {
  font-family: 'FateCore';
  src: url('../assets/fonts/fate_core_font-webfont.woff') format('woff'),
       url('../assets/fonts/fate_core_font.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
}

/* Root Variables */
:root {
  --sof-primary: #2c3e50;
  --sof-secondary: #34495e;
  --sof-accent: #3498db;
  --sof-success: #27ae60;
  --sof-warning: #f39c12;
  --sof-danger: #e74c3c;
  --sof-light: #ecf0f1;
  --sof-dark: #2c3e50;
  --sof-border: #bdc3c7;

  --fate-plus: "\002B";
  --fate-minus: "\002D";
  --fate-blank: "\0030";

  /* Fate Four Actions Icons (using FateCore font characters) */
  --fate-attack: "A";
  --fate-defend: "D";
  --fate-overcome: "O";
  --fate-create: "C";
}

/* General Sheet Styling */
.scions-of-farstar {
  font-family: 'Signika', 'Palatino Linotype', serif;
  font-size: 14px;
  color: var(--sof-dark);
}

.scions-of-farstar .window-content {
  background: var(--sof-light);
  padding: 10px;
}

.scions-of-farstar .window-header {
  color: white;
}

/* Section Headers */
.scions-of-farstar .section-header {
  background: var(--sof-primary);
  color: white;
  padding: 8px 12px;
  margin: 10px 0 5px 0;
  font-weight: bold;
  text-transform: uppercase;
  font-size: 16px;
  border-radius: 3px;
}

/* Input Fields */
.scions-of-farstar input[type="text"],
.scions-of-farstar input[type="number"],
.scions-of-farstar textarea {
  background: white;
  border: 1px solid var(--sof-border);
  padding: 4px 8px;
  border-radius: 3px;
  width: 100%;
}

.scions-of-farstar input[type="text"]:focus,
.scions-of-farstar input[type="number"]:focus,
.scions-of-farstar textarea:focus {
  outline: none;
  border-color: var(--sof-accent);
  box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
}

/* Button Styling */
.scions-of-farstar button {
  width: auto;
}

/* Extra Item Sheet - Constrain number input widths */
.scions-of-farstar.item.extra .trauma-value-field input[type="number"],
.scions-of-farstar.item.extra .track-value-field input[type="number"],
.scions-of-farstar.item.extra .skill-value-field input[type="number"] {
  width: 60px;
  max-width: 60px;
}

/* Extra Item Sheet - Aspect section layout */
.scions-of-farstar.item.extra .aspect-section {
  width: 100%;
  display: block;
  padding: 10px 15px;
  box-sizing: border-box;
}

.scions-of-farstar.item.extra .aspect-row {
  display: block;
  width: 100%;
}

.scions-of-farstar.item.extra .aspect-label-field {
  width: 100%;
  margin-bottom: 10px;
}

.scions-of-farstar.item.extra .aspect-value-field {
  width: 100%;
}

.scions-of-farstar.item.extra .aspect-label-field label,
.scions-of-farstar.item.extra .aspect-value-field label {
  display: block;
  font-weight: bold;
  font-size: 11px;
  margin-bottom: 3px;
  color: var(--sof-secondary);
}

.scions-of-farstar.item.extra .aspect-label-field input,
.scions-of-farstar.item.extra .aspect-value-field input {
  width: 100%;
}

/* Fate Dice Display */
.fate-die {
  font-family: 'FateCore', monospace;
  font-size: 24px;
  display: inline-block;
  width: 32px;
  height: 32px;
  line-height: 32px;
  text-align: center;
  margin: 0 2px;
}

.fate-die.plus {
  color: var(--sof-success);
}

.fate-die.minus {
  color: var(--sof-danger);
}

.fate-die.blank {
  color: var(--sof-border);
}

/* Fate Action Icons */
.fate-action-icon {
  font-family: 'FateCore', sans-serif;
  font-size: 28px;
  display: inline-block;
  width: 36px;
  height: 36px;
  line-height: 36px;
  text-align: center;
  margin-right: 8px;
  vertical-align: middle;
}

.fate-action-icon.attack {
  color: var(--sof-danger);
}

.fate-action-icon.attack::before {
  content: var(--fate-attack);
}

.fate-action-icon.defend {
  color: var(--sof-accent);
}

.fate-action-icon.defend::before {
  content: var(--fate-defend);
}

.fate-action-icon.overcome {
  color: var(--sof-success);
}

.fate-action-icon.overcome::before {
  content: var(--fate-overcome);
}

.fate-action-icon.create {
  color: var(--sof-warning);
}

.fate-action-icon.create::before {
  content: var(--fate-create);
}

/* Roll Buttons */
.scions-of-farstar .roll-button {
  background: var(--sof-accent);
  color: white;
  border: none;
  padding: 4px 8px;
  border-radius: 3px;
  cursor: pointer;
  font-size: 12px;
  transition: background 0.2s;
  -webkit-user-drag: element;
}

.scions-of-farstar .roll-button:hover {
  background: #2980b9;
}

.scions-of-farstar .roll-button:active {
  background: #21618c;
}

/* Make skill and capability items draggable with visual feedback */
.scions-of-farstar .skill-item[draggable="true"],
.scions-of-farstar .capability-item[draggable="true"] {
  cursor: grab;
  transition: background-color 0.2s;
}

.scions-of-farstar .skill-item[draggable="true"]:hover,
.scions-of-farstar .capability-item[draggable="true"]:hover {
  background-color: rgba(52, 152, 219, 0.1);
}

.scions-of-farstar .skill-item[draggable="true"]:active,
.scions-of-farstar .capability-item[draggable="true"]:active {
  cursor: grabbing;
}

/* Checkboxes */
.scions-of-farstar input[type="checkbox"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
}

/* Stress Boxes - standardized to 40px */
.stress-box {
  display: inline-block;
  width: 40px;
  height: 40px;
  line-height: 40px;
  text-align: center;
  border: 2px solid var(--sof-border);
  border-radius: 3px;
  margin: 0 3px;
  cursor: pointer;
  background: white;
  position: relative;
  font-size: 16px;
  color: var(--sof-secondary);
}

.stress-box::before {
  content: '1';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.stress-box.checked::before {
  content: '✖';
  color: var(--sof-danger);
  font-weight: bold;
  font-size: 18px;
}

/* Hide the ::before pseudo-element for Threat sheets (use .box-value instead) */
.threat .stress-box::before,
.threat .stress-box.checked::before {
  display: none;
}

.stress-box:hover {
  border-color: var(--sof-accent);
}

/* Stress box value display (for trauma values) */
.stress-box .box-value {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 16px;
  font-weight: normal;
  color: var(--sof-secondary);
  pointer-events: none;
}

.stress-box.checked .box-value {
  color: var(--sof-danger);
  font-weight: bold;
  font-size: 20px;
}

/* Trauma value input in edit mode */
.trauma-value-input {
  width: 40px !important;
  max-width: 40px;
  flex-shrink: 0;
  text-align: center;
  padding: 2px 4px;
  border: 1px solid var(--sof-border);
  border-radius: 3px;
}

/* Stress size toggle - gear icon style */
.stress-size-toggle {
  float: right;
  font-size: 11px;
  font-weight: normal;
  text-transform: none;
  display: flex;
  align-items: center;
  gap: 5px;
  cursor: pointer;
  opacity: 0.6;
  transition: opacity 0.2s;
}

.stress-size-toggle:hover {
  opacity: 1;
}

.stress-size-icon {
  font-size: 14px;
  color: #7f8c8d;
  transition: color 0.2s, transform 0.2s;
}

.stress-size-icon.extended {
  color: var(--sof-accent);
  transform: rotate(90deg);
}

.stress-size-label {
  color: #7f8c8d;
}

.stress-reminder {
  font-size: 11px;
  color: #7f8c8d;
  font-style: italic;
  margin-top: 4px;
}

/* Consequence toggle - gear icon style */
.consequence-toggle {
  float: right;
  font-size: 11px;
  font-weight: normal;
  text-transform: none;
  display: flex;
  align-items: center;
  gap: 5px;
  cursor: pointer;
  transition: opacity 0.2s;
}

.consequence-toggle:hover {
  opacity: 1;
}

.consequence-toggle-icon {
  font-size: 14px;
  color: #999;
  transition: color 0.2s, transform 0.2s;
}

.consequence-toggle-icon.extended {
  color: #5dade2;
  transform: rotate(90deg);
}

.consequence-toggle-label {
  color: #999;
}

.consequence-reminder {
  font-size: 11px;
  color: #999;
  font-style: italic;
  margin-top: 4px;
  margin-bottom: 8px;
}

/* Growing Stress Track (Fate style) */
.growing-stress-box {
  display: inline-block;
  width: 40px;
  height: 40px;
  line-height: 40px;
  text-align: center;
  border: 2px solid var(--sof-border);
  border-radius: 3px;
  margin: 0 3px;
  cursor: pointer;
  background: white;
  position: relative;
  font-size: 16px;
  color: var(--sof-secondary);
}

.growing-stress-box .stress-box-checkbox-hidden {
  position: absolute;
  opacity: 0;
  pointer-events: none;
}

.growing-stress-box .stress-box-number {
  display: block;
  width: 100%;
  height: 100%;
  line-height: 40px;
}

.growing-stress-box.checked .stress-box-number::before {
  content: '✖';
  color: var(--sof-danger);
  font-weight: bold;
  font-size: 18px;
}

.growing-stress-box.checked .stress-box-number {
  font-size: 0; /* Hide the number when checked */
}

.growing-stress-box:hover {
  border-color: var(--sof-accent);
}

/* Aspect Boxes */
.aspect-box {
  background: white;
  border: 1px solid var(--sof-border);
  border-left: 4px solid var(--sof-accent);
  padding: 8px;
  margin: 5px 0;
  border-radius: 3px;
}

.aspect-box label {
  font-weight: bold;
  color: var(--sof-primary);
  display: block;
  margin-bottom: 4px;
}

/* Skills and Capabilities Grid */
.skills-grid,
.capabilities-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 8px;
  margin: 10px 0;
}

.skill-item,
.capability-item {
  display: flex;
  align-items: center;
  gap: 8px;
  background: white;
  padding: 6px;
  border: 1px solid var(--sof-border);
  border-radius: 3px;
}

.skill-label,
.capability-label {
  flex: 1;
  font-weight: bold;
}

.skill-value,
.capability-value {
  width: 40px !important;
  min-width: 40px;
  max-width: 40px;
  text-align: center;
}

.skill-value.invalid,
.capability-value.invalid {
  background-color: #ffebee;
  border-color: var(--sof-danger);
  color: var(--sof-danger);
  font-weight: bold;
}

.skill-item .roll-button,
.capability-item .roll-button {
  width: 40px;
  min-width: 40px;
  padding: 2px 6px;
  font-size: 11px;
}

/* Age Track */
.age-track {
  margin: 10px 0;
}

.age-stage {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 6px;
  background: white;
  border: 1px solid var(--sof-border);
  margin: 3px 0;
  border-radius: 3px;
}

.age-stage-label {
  flex: 1;
  font-weight: bold;
}

.age-stage-checks {
  display: flex;
  gap: 15px;
  align-items: center;
}

.age-stage-checks label {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 12px;
}

/* Consequences */
.consequence-box {
  background: white;
  border: 1px solid var(--sof-border);
  border-left: 4px solid var(--sof-warning);
  padding: 8px;
  margin: 5px 0;
  border-radius: 3px;
}

.consequence-box.minor {
  border-left-color: var(--sof-accent);
}

.consequence-box.severe {
  border-left-color: var(--sof-danger);
}

.consequence-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 4px;
}

.consequence-label {
  font-weight: bold;
  color: var(--sof-warning);
}

.consequence-box.minor .consequence-label {
  color: var(--sof-accent);
}

.consequence-box.severe .consequence-label {
  color: var(--sof-danger);
}

.consequence-hint {
  font-size: 11px;
  color: #7f8c8d;
  font-style: italic;
  margin-top: 4px;
}

.consequence-treated {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 12px;
}

/* Stunts and Extras */
.stunt-item,
.extra-item {
  background: white;
  border: 1px solid var(--sof-border);
  padding: 10px;
  margin: 5px 0;
  border-radius: 3px;
}

.stunt-header,
.extra-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 6px;
}

.stunt-name,
.extra-name {
  font-weight: bold;
  flex: 1;
}

.stunt-delete,
.extra-delete {
  background: var(--sof-danger);
  color: white;
  border: none;
  padding: 2px 6px;
  border-radius: 3px;
  cursor: pointer;
  font-size: 11px;
}

.add-item-button {
  background: var(--sof-success);
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 3px;
  cursor: pointer;
  width: 100%;
  margin-top: 5px;
}

.add-item-button:hover {
  background: #229954;
}

/* Refresh and Fate Points */
.fate-points-container {
  display: flex;
  gap: 20px;
  margin: 10px 0;
}

.fate-point-box {
  flex: 1;
  background: white;
  border: 2px solid var(--sof-accent);
  border-radius: 3px;
  padding: 10px;
  text-align: center;
}

.fate-point-label {
  font-size: 12px;
  color: var(--sof-primary);
  text-transform: uppercase;
  font-weight: bold;
  margin-bottom: 5px;
}

.fate-point-value {
  font-size: 32px;
  font-weight: bold;
  color: var(--sof-accent);
}

/* Edit Mode Toggle */
.edit-mode-toggle {
  position: absolute;
  top: 10px;
  right: 10px;
  background: var(--sof-secondary);
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 3px;
  cursor: pointer;
  font-size: 12px;
}

.edit-mode-toggle.active {
  background: var(--sof-accent);
}

/* Countdown Ladders */
.countdown-ladder {
  margin: 10px 0;
}

.ladder-stage {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px;
  background: white;
  border: 1px solid var(--sof-border);
  margin: 3px 0;
  border-radius: 3px;
}

.ladder-checkbox {
  width: 20px;
  height: 20px;
}

.ladder-stage-name {
  flex: 1;
}

/* Utility Classes */
.flex {
  display: flex;
}

.flex-col {
  flex-direction: column;
}

.gap-sm {
  gap: 5px;
}

.gap-md {
  gap: 10px;
}

.gap-lg {
  gap: 15px;
}

.mb-sm {
  margin-bottom: 5px;
}

.mb-md {
  margin-bottom: 10px;
}

.mb-lg {
  margin-bottom: 15px;
}

.text-center {
  text-align: center;
}

.font-bold {
  font-weight: bold;
}

/* ===========================
   Two-Column Layout
   =========================== */

.two-column-layout {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
  padding: 10px;
}

/* Threat sheet specific: use CSS columns for better gap filling */
.threat .two-column-layout {
  display: block;
  column-count: 2;
  column-gap: 15px;
}

.threat .two-column-layout > * {
  break-inside: avoid;
  margin-bottom: 15px;
}

.subsection-header {
  background: var(--sof-secondary);
  color: white;
  padding: 6px 10px;
  font-weight: bold;
  font-size: 13px;
}

/* Threat sheet specific subsection header styling - ONLY when NOT inside section-header-row */
.threat .section-box > .subsection-header {
  display: block;
  margin: -12px -12px 8px -12px;
  border-radius: 4px 4px 0 0;
}

/* Scion column headers - lighter navy to differentiate from Faction */
.scion-column .section-header {
  background: #4a6278; /* Lighter shade of navy */
}

.scion-column .subsection-header {
  background: #5a748c; /* Lighter shade of secondary navy */
}

/* Skills and Capabilities Lists (Vertical) */
.skills-list,
.capabilities-list {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin: 8px 0;
}

/* Stunt and Extra Header Fix */
.stunt-name,
.extra-name {
  font-weight: bold;
  flex: 1;
  min-width: 0; /* Allow flexbox to shrink */
  padding: 4px 8px;
  border: 1px solid var(--sof-border);
  border-radius: 3px;
}

.stunt-delete,
.extra-delete {
  background: var(--sof-danger);
  color: white;
  border: none;
  padding: 4px 8px;
  border-radius: 3px;
  cursor: pointer;
  font-size: 12px;
  flex-shrink: 0; /* Don't let delete button shrink */
  min-width: 32px;
}

.stunt-delete:hover,
.extra-delete:hover {
  background: #c0392b;
}

/* New Stunt Item Styling */
.stunts-list {
  margin: 10px 0;
}

.stunt-item[draggable="true"] {
  cursor: grab;
  transition: background-color 0.2s, box-shadow 0.2s;
}

.stunt-item[draggable="true"]:hover {
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.stunt-item[draggable="true"]:active {
  cursor: grabbing;
}

/* Scope-based background colors */
.stunt-item.scope-faction {
  background: #f8f9fa;
  border-left: 4px solid var(--sof-primary);
}

.stunt-item.scope-scion {
  background: #e3f2fd;
  border-left: 4px solid var(--sof-accent);
}

.stunt-item.scope-other {
  background: #f8f9fa;
  border-left: 4px solid #6c757d;
}

.stunt-item .stunt-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
  padding-bottom: 6px;
  border-bottom: 1px solid var(--sof-border);
}

.stunt-item .stunt-icon {
  width: 32px;
  height: 32px;
  border-radius: 3px;
  border: 1px solid var(--sof-border);
  object-fit: cover;
}

.stunt-item .stunt-name {
  flex: 1;
  font-weight: bold;
  font-size: 14px;
  color: var(--sof-primary);
  border: none;
  padding: 0;
  margin: 0;
  background: none;
}

.stunt-item .item-controls {
  display: flex;
  gap: 4px;
  margin-left: auto;
}

.stunt-item .item-control {
  background: none;
  border: none;
  color: var(--sof-secondary);
  cursor: pointer;
  padding: 4px 8px;
  border-radius: 3px;
  transition: all 0.2s;
}

.stunt-item .item-control:hover {
  background: var(--sof-border);
  color: var(--sof-primary);
}

.stunt-item .item-delete:hover {
  background: var(--sof-danger);
  color: white;
}

.stunt-item .stunt-content {
  color: var(--sof-text);
  font-size: 13px;
  line-height: 1.5;
}

.stunt-item .stunt-content p {
  margin: 4px 0;
}

.stunt-item .stunt-content em {
  color: var(--sof-secondary);
}

/* Add stunt buttons */
.add-stunt-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 12px;
  padding-top: 12px;
  border-top: 2px solid var(--sof-border);
}

.add-stunt-buttons .add-item-button {
  flex: 1 1 calc(33.333% - 8px);
  min-width: 150px;
  padding: 8px 12px;
  background: var(--sof-accent);
  color: white;
  border: none;
  border-radius: 3px;
  cursor: pointer;
  font-size: 13px;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}

.add-stunt-buttons .add-item-button:hover {
  background: #2980b9;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

/* Stunt item sheet styles */
.stunt-config-section {
  margin-bottom: 12px;
}

.stunt-config-section .config-row {
  display: flex;
  gap: 12px;
  margin-bottom: 12px;
}

.stunt-config-section .config-field {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.stunt-config-section .config-field label {
  font-weight: bold;
  font-size: 12px;
  color: var(--sof-secondary);
  margin-bottom: 4px;
}

.stunt-config-section .config-field select {
  padding: 6px;
  border: 1px solid var(--sof-border);
  border-radius: 3px;
  font-size: 13px;
}

.stunt-config-section .scope-display {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px;
  background: #f8f9fa;
  border-radius: 3px;
  font-size: 12px;
}

.stunt-config-section .scope-value {
  font-weight: bold;
  padding: 2px 8px;
  border-radius: 3px;
}

.stunt-config-section .scope-value.scope-faction {
  background: var(--sof-primary);
  color: white;
}

.stunt-config-section .scope-value.scope-scion {
  background: var(--sof-accent);
  color: white;
}

.stunt-config-section .scope-value.scope-other {
  background: #6c757d;
  color: white;
}

.stunt-config-section .scope-hint {
  color: var(--sof-secondary);
  font-style: italic;
}

/* Stunt Item Sheet Header with Profile Image */
.scions-of-farstar.sheet.item.stunt .sheet-header {
  display: flex;
  align-items: flex-start;
  gap: 16px;
  padding: 12px;
  border-bottom: 2px solid var(--sof-border);
  background: linear-gradient(to bottom, #f8f9fa 0%, #ffffff 100%);
}

.scions-of-farstar.sheet.item.stunt .icon-section {
  display: flex;
  flex-direction: column;
  gap: 8px;
  flex-shrink: 0;
}

.scions-of-farstar.sheet.item.stunt .stunt-profile-img {
  flex-shrink: 0;
  border: 2px solid var(--sof-border);
  border-radius: 4px;
  cursor: pointer;
  object-fit: cover;
  transition: border-color 0.2s, box-shadow 0.2s;
  padding: 2px;
}

.scions-of-farstar.sheet.item.stunt .stunt-profile-img:hover {
  border-color: var(--sof-primary);
  box-shadow: 0 0 8px rgba(26, 53, 80, 0.3);
}

.scions-of-farstar.sheet.item.stunt .icon-bg-picker {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.scions-of-farstar.sheet.item.stunt .icon-bg-picker input[type="color"] {
  width: 80px;
  height: 32px;
  padding: 2px;
  border: 1px solid var(--sof-border);
  border-radius: 3px;
  cursor: pointer;
}

.scions-of-farstar.sheet.item.stunt .clear-bg-button {
  padding: 4px;
  background: #dc3545;
  color: white;
  border: none;
  border-radius: 3px;
  cursor: pointer;
  transition: background 0.2s;
  font-size: 11px;
}

.scions-of-farstar.sheet.item.stunt .clear-bg-button:hover {
  background: #c82333;
}

.scions-of-farstar.sheet.item.stunt .header-fields {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.scions-of-farstar.sheet.item.stunt .name-field {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.scions-of-farstar.sheet.item.stunt .name-field input {
  width: 100%;
  font-size: 16px;
  font-weight: 600;
  padding: 6px;
  border: 1px solid var(--sof-border);
  border-radius: 3px;
}

.scions-of-farstar.sheet.item.stunt .field-label {
  font-size: 11px;
  font-weight: 600;
  color: var(--sof-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.stunt-effect-section .effect-description {
  padding: 12px;
  background: #e3f2fd;
  border-left: 4px solid var(--sof-accent);
  border-radius: 3px;
  display: flex;
  align-items: flex-start;
  gap: 8px;
  font-size: 13px;
  line-height: 1.6;
}

.stunt-effect-section .effect-description i {
  color: var(--sof-accent);
  margin-top: 2px;
}

/* ===== EXTRA ITEM SHEETS ===== */

.scions-of-farstar.sheet.item.extra .icon-section {
  display: flex;
  flex-direction: column;
  gap: 8px;
  flex-shrink: 0;
}

.scions-of-farstar.sheet.item.extra .extra-profile-img {
  flex-shrink: 0;
  border: 2px solid var(--sof-border);
  border-radius: 4px;
  cursor: pointer;
  object-fit: cover;
  transition: border-color 0.2s, box-shadow 0.2s;
  padding: 2px;
}

.scions-of-farstar.sheet.item.extra .extra-profile-img:hover {
  border-color: var(--sof-primary);
  box-shadow: 0 0 8px rgba(26, 53, 80, 0.3);
}

.scions-of-farstar.sheet.item.extra .icon-bg-picker {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.scions-of-farstar.sheet.item.extra .icon-bg-picker input[type="color"] {
  width: 80px;
  height: 32px;
  padding: 2px;
  border: 1px solid var(--sof-border);
  border-radius: 3px;
  cursor: pointer;
}

.scions-of-farstar.sheet.item.extra .clear-bg-button {
  padding: 4px;
  background: #dc3545;
  color: white;
  border: none;
  border-radius: 3px;
  cursor: pointer;
  transition: background 0.2s;
  font-size: 11px;
}

.scions-of-farstar.sheet.item.extra .clear-bg-button:hover {
  background: #c82333;
}

.scions-of-farstar.sheet.item.extra .header-fields {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.scions-of-farstar.sheet.item.extra .sheet-header {
  display: flex;
  gap: 15px;
  align-items: flex-start;
  padding: 15px;
  border-bottom: 2px solid var(--sof-border);
  background: linear-gradient(to bottom, #f8f9fa 0%, #ffffff 100%);
}

/* People Track States */
.people-box {
  position: relative;
  cursor: pointer;
  transition: all 0.2s;
}

.people-box.committed {
  background: #f39c12;
  border-color: #e67e22;
}

.people-box.committed .box-number {
  color: white;
  font-weight: bold;
}

.people-box.expended {
  background: #e74c3c;
  border-color: #c0392b;
}

.people-box.expended .box-number {
  color: white;
  font-weight: bold;
  text-decoration: line-through;
  text-decoration-thickness: 2px;
}

.people-box .box-mark {
  color: white;
  font-weight: bold;
  font-size: 18px;
}

.track-legend {
  font-size: 11px;
  color: var(--sof-secondary);
  font-style: italic;
  margin-top: 4px;
}

.people-track-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.track-legend-inline {
  font-size: 11px;
  color: #888;
  font-style: italic;
  font-weight: normal;
  white-space: nowrap;
}

/* Editor Container for Notes Tab */
.editor-container {
  min-height: 400px;
  padding: 10px;
}

.editor-container .editor {
  min-height: 350px;
}

/* Validation Warning Styling */
.validation-warning {
  color: var(--sof-warning);
  font-weight: bold;
  font-size: 12px;
  margin-left: 8px;
}

.validation-section {
  margin-top: 8px;
  padding: 8px;
  background-color: rgba(255, 152, 0, 0.1);
  border-left: 3px solid var(--sof-warning);
  border-radius: 4px;
}

.validation-section .validation-warning {
  margin: 4px 0;
  display: block;
}

/* Colony Attribute Total Display */
.attribute-total-display {
  font-size: 14px;
  font-weight: bold;
  margin-bottom: 8px;
  text-align: center;
  padding: 4px;
  background-color: rgba(0, 0, 0, 0.05);
  border-radius: 4px;
}

/* Colony Validation Warnings */
.attributes-section .validation-warning {
  margin: 8px 0;
  padding: 8px 12px;
  border-radius: 4px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.attributes-section .validation-warning.error {
  background-color: rgba(220, 38, 38, 0.1);
  border-left: 3px solid #dc2626;
  color: #dc2626;
}

.attributes-section .validation-warning.low {
  background-color: rgba(59, 130, 246, 0.1);
  border-left: 3px solid #3b82f6;
  color: #3b82f6;
}

.attributes-section .validation-warning.high {
  background-color: rgba(251, 146, 60, 0.1);
  border-left: 3px solid #fb923c;
  color: #fb923c;
}

.attributes-section .validation-warning i {
  font-size: 16px;
}

.attributes-section .validation-warning ul {
  margin: 4px 0 0 0;
  padding-left: 20px;
}

/* Fate Point Controls */
.fate-point-controls {
  display: flex;
  align-items: center;
  gap: 5px;
}

.fate-points-increment,
.fate-points-decrement {
  background: var(--sof-accent);
  color: white;
  border: none;
  padding: 4px 8px;
  border-radius: 3px;
  cursor: pointer;
  font-size: 16px;
  font-weight: bold;
  min-width: 30px;
}

.fate-points-increment:hover,
.fate-points-decrement:hover {
  background: #2980b9;
}

/* Responsive adjustments */
@media (max-width: 900px) {
  .two-column-layout {
    grid-template-columns: 1fr;
  }
}

/* ===========================
   Header Enhancements
   =========================== */

.sheet-header {
  display: flex;
  flex-direction: row;
  gap: 10px;
  margin-bottom: 10px;
  align-items: flex-start;
}

.header-fields {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.profile-img {
  border: 2px solid var(--sof-border);
  border-radius: 4px;
  cursor: pointer;
  flex-shrink: 0;
}

.profile-img:hover {
  border-color: var(--sof-accent);
}

.name-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}

.name-field {
  display: flex;
  flex-direction: column;
}

.field-label {
  font-size: 11px;
  font-weight: bold;
  color: var(--sof-secondary);
  text-transform: uppercase;
  margin-bottom: 3px;
}

.name-field input {
  padding: 6px 8px;
  border: 1px solid var(--sof-border);
  border-radius: 3px;
  font-size: 16px;
  font-weight: bold;
}

/* Resource row - Refresh and Fate Points on same line */
.resource-row {
  display: flex;
  align-items: center;
  gap: 20px;
}

.resource {
  display: flex;
  align-items: center;
  gap: 8px;
}

.resource-label {
  font-size: 12px;
  font-weight: bold;
  color: var(--sof-secondary);
  text-transform: uppercase;
  white-space: nowrap;
}

/* Refresh display - read-only, compact */
.refresh-display .refresh-value {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 40px;
  padding: 6px 12px;
  background: #f8f9fa;
  border: 2px solid var(--sof-border);
  border-radius: 3px;
  font-size: 18px;
  font-weight: bold;
  color: var(--sof-primary);
}

.refresh-display .refresh-value.invalid {
  background: #ffebee;
  border-color: var(--sof-danger);
  color: var(--sof-danger);
}

/* Fate Points - compact controls */
.fate-points-display .fate-point-controls {
  display: flex;
  align-items: center;
  gap: 3px;
}

.fate-points-display input[type="number"] {
  width: 40px;
  min-width: 40px;
  height: 40px;
  text-align: center;
  padding: 0;
  font-size: 18px;
  font-weight: bold;
  border: 2px solid var(--sof-border);
  border-radius: 3px;
}

.fate-points-increment,
.fate-points-decrement {
  min-width: 28px;
  padding: 4px 6px;
  font-size: 14px;
}

/* Roll 4dF button - inline with Fate Points */
.roll-fate-inline {
  display: flex;
  align-items: center;
}

.roll-fate-inline .roll-fate-header {
  padding: 8px 16px;
  font-size: 14px;
  background: var(--sof-success);
  white-space: nowrap;
  height: 40px;
  display: flex;
  align-items: center;
}

.roll-fate-inline .roll-fate-header:hover {
  background: #229954;
}

/* Aspect row in header - stacked vertically for full width */
.aspect-row {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 8px;
}

/* ===========================
   People Track Enhancements
   =========================== */

.people-box-container {
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  margin: 0 3px;
}

.box-value-label {
  font-size: 12px;
  font-weight: bold;
  color: var(--sof-secondary);
  margin-bottom: 4px;
  height: 16px;
}

.population-label {
  font-size: 9px;
  color: #888;
  margin-top: 2px;
  height: 12px;
  font-style: italic;
}

.people-box {
  display: inline-block;
  width: 40px;
  height: 40px;
  line-height: 40px;
  text-align: center;
  border: 2px solid var(--sof-border);
  border-radius: 3px;
  cursor: pointer;
  background: white;
  position: relative;
}

.people-box:hover {
  border-color: var(--sof-accent);
}

.people-box.growing {
  position: relative;
}

.people-box .box-number {
  font-size: 16px;
  color: var(--sof-secondary);
}

/* ===========================
   Consequence States
   =========================== */

.consequence-box.active {
  border-left-color: var(--sof-warning);
  background: #fef5e7;
}

.consequence-box.minor.active {
  border-left-color: var(--sof-accent);
  background: #e3f2fd;
}

.consequence-box.severe.active {
  border-left-color: var(--sof-danger);
  background: #ffebee;
}

.consequence-status {
  display: flex;
  align-items: center;
  gap: 10px;
}

.status-badge {
  padding: 2px 8px;
  border-radius: 3px;
  font-size: 11px;
  font-weight: bold;
  text-transform: uppercase;
}

.status-badge.unused {
  background: #ecf0f1;
  color: #95a5a6;
}

.status-badge.active {
  background: #f39c12;
  color: white;
}

.status-badge.treated {
  background: #27ae60;
  color: white;
}

.treated-checkbox {
  font-size: 12px;
  display: flex;
  align-items: center;
  gap: 4px;
}

/* Free Invoke Checkbox Styling */
.free-invoke-checkbox {
  font-size: 12px;
  display: flex;
  align-items: center;
  gap: 4px;
}

/* Hide the default checkbox appearance */
/* Unchecked = Available (bright green with white plus) */
.free-invoke-checkbox input[type="checkbox"],
.age-invoke-used {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  width: 20px;
  height: 20px;
  border: 2px solid var(--sof-success);
  border-radius: 50%;
  position: relative;
  cursor: pointer;
  background: var(--sof-success);
  transition: all 0.2s ease;
}

.free-invoke-checkbox input[type="checkbox"]:hover,
.age-invoke-used:hover {
  box-shadow: 0 0 5px rgba(39, 174, 96, 0.5);
}

/* Plus symbol using pseudo-element */
.free-invoke-checkbox input[type="checkbox"]::before,
.age-invoke-used::before {
  content: '+';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 16px;
  font-weight: bold;
  color: white;
  line-height: 1;
  text-align: center;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  transition: all 0.2s ease;
}

/* Checked = Spent/Used (faded with gray plus) */
.free-invoke-checkbox input[type="checkbox"]:checked,
.age-invoke-used:checked {
  background: white;
  border-color: var(--sof-border);
}

.free-invoke-checkbox input[type="checkbox"]:checked::before,
.age-invoke-used:checked::before {
  color: var(--sof-border);
}

/* ===========================
   Stunt/Extra Input Fixes
   =========================== */

.stunt-header,
.extra-header {
  display: flex;
  gap: 8px;
  align-items: center;
  margin-bottom: 8px;
}

.stunt-name,
.extra-name {
  flex: 1;
  min-width: 0;
  font-weight: bold;
  padding: 6px 10px;
  border: 1px solid var(--sof-border);
  border-radius: 3px;
  font-size: 14px;
}

.stunt-delete,
.extra-delete {
  flex-shrink: 0;
  width: 36px;
  height: 36px;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

.stunt-description,
.extra-description {
  margin-top: 8px;
}

.stunt-description .editor,
.extra-description .editor {
  min-height: 100px;
}

.stunt-item textarea,
.extra-item textarea {
  width: 100%;
  padding: 8px;
  border: 1px solid var(--sof-border);
  border-radius: 3px;
  font-family: inherit;
  resize: vertical;
}

/* ===========================
   Notes Editor Height Fix
   =========================== */

.notes-tab .editor-container {
  min-height: 400px;
  max-height: 600px;
  display: flex;
  flex-direction: column;
}

.notes-tab .editor-container .editor {
  flex: 1;
  min-height: 350px;
  max-height: 550px;
}

.notes-tab .editor-container .editor-content {
  min-height: 300px;
  max-height: 500px;
}

/* ===========================
   Chat Message Fate Roll Styling
   =========================== */

.fate-roll {
  padding: 10px;
  border-left: 4px solid var(--sof-accent);
  background: #f8f9fa;
  border-radius: 4px;
}

.fate-roll h3 {
  margin: 0 0 8px 0;
  font-size: 16px;
  font-weight: bold;
  color: var(--sof-primary);
  display: flex;
  align-items: center;
}

.fate-roll .roll-description {
  margin: 8px 0;
  padding: 6px;
  background: rgba(52, 152, 219, 0.1);
  border-radius: 3px;
  font-size: 13px;
  color: var(--sof-secondary);
  line-height: 1.5;
}

.fate-roll .roll-description .skill-name {
  font-weight: bold;
  color: var(--sof-primary);
}

.fate-roll .roll-description .stunt-info {
  margin-top: 4px;
  font-style: italic;
  color: var(--sof-accent);
}

.fate-roll .roll-description .stunt-description {
  margin-top: 8px;
  padding: 8px;
  background: #fff3cd;
  border-left: 3px solid #ffc107;
  border-radius: 3px;
  font-style: italic;
  color: #856404;
  font-size: 13px;
  line-height: 1.6;
}

.fate-roll .dice-results {
  margin: 10px 0;
  text-align: center;
}

.fate-roll .roll-total {
  margin-top: 12px;
  padding: 8px;
  background: white;
  border-radius: 3px;
  text-align: center;
  font-size: 14px;
}

.fate-roll .roll-total strong:last-child {
  font-size: 28px;
  margin-left: 8px;
}

/* Roll result color coding */
.fate-roll .roll-total .result-blue {
  color: var(--sof-accent); /* Blue for within ±1 of modifier */
}

.fate-roll .roll-total .result-green {
  color: #27ae60; /* Green for high rolls (>modifier+1) */
}

.fate-roll .roll-total .result-orange {
  color: #f39c12; /* Orange for low rolls (<modifier-1) */
}

.fate-roll .roll-total .result-red {
  color: #e74c3c; /* Red for very low rolls (<1) */
}

/* ===========================
   Age Track Table Layout
   =========================== */

.age-track-table {
  margin: 10px 0;
  display: table;
  width: 100%;
  border-collapse: collapse;
}

.age-track-header,
.age-track-row {
  display: table-row;
}

.age-track-cell {
  display: table-cell;
  padding: 6px 8px;
  border: 1px solid var(--sof-border);
  text-align: center;
  vertical-align: middle;
}

.age-track-cell.age-header {
  background: #5a748c; /* Match Scion subsection header color */
  color: white;
  font-weight: bold;
  font-size: 12px;
  text-transform: uppercase;
}

.age-track-cell.age-label {
  font-weight: bold;
  font-size: 13px;
  color: var(--sof-primary);
  background: #f8f9fa;
  text-align: left;
  min-width: 80px;
}

/* Current age highlighting */
.age-track-cell.age-label.current-age {
  font-weight: bold;
  font-size: 15px;
  color: var(--sof-accent);
  background: #e3f2fd;
  border-left: 4px solid var(--sof-accent);
}

/* Passed and Scarred age strikethrough */
.age-track-cell.age-label.passed-age,
.age-track-cell.age-label.scarred-age {
  text-decoration: line-through;
  color: #999;
}

.age-track-cell.age-checkbox {
  width: 40px;
  background: white;
}

.age-track-cell.age-checkbox input[type="checkbox"] {
  margin: 0;
  cursor: pointer;
}

.age-track-cell.age-checkbox input[type="checkbox"].hidden {
  visibility: hidden;
}

.age-track-cell.age-checkbox input[type="checkbox"].disabled-checkbox {
  opacity: 0.3;
  cursor: not-allowed;
  pointer-events: none;
}

/* Wound stress box styling - standardized to 40px */
.wound-stress-box {
  display: inline-block;
  width: 40px;
  height: 40px;
  line-height: 40px;
  text-align: center;
  border: 2px solid var(--sof-border);
  border-radius: 3px;
  cursor: pointer;
  background: white;
  position: relative;
  font-size: 16px;
  color: var(--sof-secondary);
}

.wound-stress-box::before {
  content: '1';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.wound-stress-box.checked::before {
  content: '✖';
  color: var(--sof-danger);
  font-weight: bold;
  font-size: 18px;
}

.wound-stress-box:hover {
  border-color: var(--sof-accent);
}

.wound-stress-box.hidden {
  visibility: hidden;
}

/* ===========================
   Tab Content Styling
   =========================== */

.sheet-body {
  flex: 0 0 auto;
  overflow: hidden;
}

.sheet-body .tab {
  display: none;
  padding: 10px;
}

.sheet-body .tab.active {
  display: block;
}

.stunts-tab,
.extras-tab {
  min-height: 0;
}

/* Empty state message */
.empty-message {
  padding: 40px 20px;
  text-align: center;
  color: #95a5a6;
  font-style: italic;
  background: rgba(0, 0, 0, 0.02);
  border-radius: 4px;
  margin: 20px 0;
}

/* ===========================
   Colony Sheet Styles
   =========================== */

.colony .aspects-section.colony-aspects {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-bottom: 20px;
}

.colony .aspect-field {
  width: 100%;
}

.colony .aspect-field label {
  display: block;
  font-weight: bold;
  margin-bottom: 4px;
  color: var(--sof-primary);
}

.colony .aspect-field input[type="text"] {
  width: 100%;
  padding: 6px 10px;
  border: 1px solid var(--sof-border);
  border-radius: 4px;
  font-size: 14px;
}

/* Attributes Pyramid */
.attributes-section {
  margin-bottom: 24px;
}

.attributes-pyramid {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.attribute-rank {
  display: flex;
  align-items: center;
  gap: 12px;
  min-height: 40px;
  padding: 8px;
  background: rgba(0, 0, 0, 0.02);
  border-radius: 4px;
  border: 2px dashed transparent;
  transition: all 0.2s;
}

.attribute-rank.drag-over {
  border-color: var(--sof-accent);
  background: rgba(52, 152, 219, 0.1);
}

.attribute-rank.invalid {
  border-color: var(--sof-warning);
  background: rgba(255, 152, 0, 0.1);
}

.rank-label {
  font-size: 18px;
  font-weight: bold;
  color: var(--sof-primary);
  min-width: 40px;
  text-align: center;
}

.rank-count {
  font-size: 12px;
  font-weight: normal;
  color: #999;
  min-width: 30px;
  text-align: center;
  margin-left: auto;
  padding-right: 8px;
}

.rank-attributes {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  flex: 1;
  align-items: center;
}

.attribute-item {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 0;
  background: white;
  border: 1px solid var(--sof-border);
  border-radius: 4px;
  cursor: grab;
  transition: all 0.2s;
  overflow: hidden;
}

/* Damaged attribute status - red tinted background with dark red text */
.attribute-item.damaged {
  background: rgba(220, 53, 69, 0.15);
  border-color: rgba(220, 53, 69, 0.3);
}

.attribute-item.damaged .attribute-name {
  color: #a71d2a;
}

/* In-repair attribute status - orange tinted background */
.attribute-item.in-repair {
  background: rgba(255, 152, 0, 0.15);
  border-color: rgba(255, 152, 0, 0.3);
}

.attribute-item.in-repair .attribute-name {
  color: #cc7a00;
}

.attribute-item::before {
  content: '';
  display: block;
  width: 8px;
  height: 100%;
  background: linear-gradient(to bottom, #95a5a6 0%, #7f8c8d 100%);
  cursor: grab;
  flex-shrink: 0;
  border-right: 1px solid var(--sof-border);
}

.attribute-item:active::before {
  cursor: grabbing;
}

.attribute-item:hover {
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  transform: translateY(-1px);
}

.attribute-item:hover::before {
  background: linear-gradient(to bottom, var(--sof-accent) 0%, #2980b9 100%);
}

.attribute-item .roll-button {
  width: 40px;
  height: 32px;
  padding: 0;
  font-size: 14px;
  background: var(--sof-accent);
  color: white;
  border: none;
  cursor: pointer;
  transition: background 0.2s;
  flex-shrink: 0;
  margin-left: 6px;
}

.attribute-item .roll-button:hover {
  background: #2980b9;
}

.attribute-item .attribute-name {
  border: none;
  background: transparent;
  font-size: 14px;
  font-weight: 500;
  color: var(--sof-primary);
  padding: 6px 8px;
  min-width: 80px;
  flex: 1;
}

.attribute-item .attribute-name.locked {
  cursor: not-allowed;
  opacity: 0.8;
}

.attribute-item .attribute-name:focus {
  outline: 1px solid var(--sof-accent);
  outline-offset: 2px;
  border-radius: 2px;
}

.attribute-item .delete-attribute {
  width: 40px;
  height: 32px;
  padding: 0;
  font-size: 14px;
  background: transparent;
  color: var(--sof-danger);
  border: none;
  cursor: pointer;
  opacity: 0.3;
  transition: opacity 0.2s;
  flex-shrink: 0;
  margin-right: 4px;
}

/* Lock icon for locked attributes (replaces delete button) */
.attribute-item .lock-indicator {
  width: 40px;
  height: 32px;
  padding: 0;
  font-size: 12px;
  background: transparent;
  color: #999;
  border: none;
  cursor: default;
  opacity: 0.3;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  margin-right: 4px;
}

.attribute-item:hover .delete-attribute {
  opacity: 1;
}

.attribute-item:hover .lock-indicator {
  opacity: 0.6;
}

.attribute-item .delete-attribute:hover {
  color: #c0392b;
  background: rgba(231, 76, 60, 0.1);
}

.add-attribute {
  padding: 8px 16px;
  background: var(--sof-success);
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  transition: background 0.2s;
  width: auto;
}

.add-attribute:hover {
  background: #229954;
}

/* Population Track Section */
.population-track-section {
  margin-top: 24px;
}

.population-track-section .section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.population-track-section .track-legend {
  font-size: 11px;
  color: #888;
  font-style: italic;
  font-weight: normal;
}

.population-track {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.population-box-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
}

.population-box {
  width: 50px;
  height: 50px;
  border: 2px solid var(--sof-primary);
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  font-weight: bold;
  color: var(--sof-primary);
  cursor: pointer;
  background: white;
  transition: all 0.2s;
}

.population-box:hover {
  transform: scale(1.05);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.population-box.expended {
  position: relative;
  opacity: 0.6;
}

.population-box.expended::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 10%;
  right: 10%;
  height: 3px;
  background: var(--sof-danger);
  transform: translateY(-50%) rotate(-15deg);
}

.population-box.expended::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 10%;
  right: 10%;
  height: 3px;
  background: var(--sof-danger);
  transform: translateY(-50%) rotate(15deg);
}

.population-scale {
  font-size: 9px;
  color: #888;
  text-align: center;
  font-style: italic;
  min-height: 12px;
}

/* ===========================
   Threat Sheet Styles
   =========================== */

/* Edit/Play Mode Toggle */
.threat .mode-toggle {
  display: flex;
  align-items: center;
  justify-content: flex-end;
}

.threat .toggle-edit-mode {
  background: var(--sof-secondary);
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 3px;
  cursor: pointer;
  font-size: 13px;
  transition: background 0.2s;
  white-space: nowrap;
}

.threat .toggle-edit-mode:hover {
  background: var(--sof-primary);
}

/* Priority Number Inputs - Make them compact with pale blue background */
.threat .priority-input {
  width: 50px !important;
  min-width: 50px !important;
  max-width: 50px !important;
  text-align: center;
  padding: 4px !important;
  font-size: 12px;
  background: #e3f2fd;
  border: 1px solid #90caf9;
}

/* Section header row styling - applies to both edit and play mode */
.threat .section-header-row {
  display: flex;
  align-items: center;
  gap: 10px;
  background: var(--sof-secondary);
  padding: 8px 10px;
  margin: -12px -12px 8px -12px;
  border-radius: 4px 4px 0 0;
  flex-wrap: wrap;
}

/* In play mode, remove the double background from subsection-header inside section-header-row */
.threat .section-header-row .subsection-header {
  background: none;
  margin: 0;
  padding: 0;
  border-radius: 0;
  flex: 1;
}

.threat .section-header-row .section-heading-edit {
  flex: 1;
  min-width: 150px;
  background: rgba(255, 255, 255, 0.95);
  color: var(--sof-secondary);
  font-weight: bold;
  padding: 6px 10px;
  border: 1px solid var(--sof-border);
  border-radius: 3px;
}

.threat .section-header-row label {
  color: white;
  font-size: 12px;
  white-space: nowrap;
}

/* Control spans (like skill count, rung count) should be white text */
.threat .section-header-row span {
  color: white;
  font-size: 12px;
}

/* Priority label styling */
.threat .section-header-row label:has(.priority-input) {
  background: #e3f2fd;
  color: var(--sof-secondary);
  padding: 4px 8px;
  border-radius: 3px;
  border: 1px solid #90caf9;
}

/* Visibility checkbox label styling - match priority styling */
.threat .section-header-row label:has(.section-visibility-toggle),
.threat .section-header-row label:has(.aspect-visibility-toggle),
.threat .section-header-row label:has(.track-visibility-toggle),
.threat .section-header-row label:has(.consequence-visibility-toggle) {
  background: #e3f2fd;
  color: var(--sof-secondary);
  padding: 4px 8px;
  border-radius: 3px;
  border: 1px solid #90caf9;
}

/* Skill/Ladder Count Controls - Compact buttons */
.threat .skill-count-controls,
.threat .ladder-rung-controls {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-left: auto;
}

.threat .skill-count-increment,
.threat .skill-count-decrement,
.threat .ladder-rung-increment,
.threat .ladder-rung-decrement {
  background: var(--sof-accent);
  color: white;
  border: none;
  padding: 4px 8px;
  border-radius: 3px;
  cursor: pointer;
  font-size: 14px;
  font-weight: bold;
  width: 40px;
  min-width: 40px;
  max-width: 40px;
  height: 28px;
  transition: background 0.2s;
}

.threat .skill-count-increment:hover,
.threat .skill-count-decrement:hover,
.threat .ladder-rung-increment:hover,
.threat .ladder-rung-decrement:hover {
  background: #2980b9;
}

/* Stress Max Controls - Compact buttons */
.threat .stress-max-controls {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-left: 8px;
}

.threat .stress-max-increment,
.threat .stress-max-decrement {
  background: var(--sof-accent);
  color: white;
  border: none;
  padding: 4px 8px;
  border-radius: 3px;
  cursor: pointer;
  font-size: 14px;
  font-weight: bold;
  width: 40px;
  min-width: 40px;
  max-width: 40px;
  height: 28px;
  transition: background 0.2s;
}

.threat .stress-max-increment:hover,
.threat .stress-max-decrement:hover {
  background: #2980b9;
}

/* Removed duplicate section-header-row rules - consolidated above at line 1655 */

/* Aspect Edit Controls */
.threat .aspect-edit-controls {
  display: flex;
  gap: 10px;
  align-items: center;
  margin-bottom: 4px;
  flex-wrap: wrap;
}

.threat .aspect-label-edit {
  flex: 1;
  min-width: 120px;
  font-weight: bold;
  font-size: 12px;
}

/* Hidden in Play Mode */
.threat .hidden-in-play {
  opacity: 0.5;
  border-style: dashed;
}

/* Ladder Track Styles */
.threat .ladder-section {
  margin: 10px 0;
}

.threat .ladder-label {
  font-weight: bold;
  margin-bottom: 8px;
  font-size: 14px;
  color: var(--sof-primary);
}

.threat .ladder-label-edit {
  margin-bottom: 8px;
}

.threat .ladder-label-input {
  width: 100%;
  max-width: 300px;
  padding: 4px 8px;
  font-weight: bold;
}

.threat .ladder-track {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.threat .ladder-rung {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px;
  background: white;
  border: 1px solid var(--sof-border);
  border-radius: 3px;
  transition: all 0.2s;
}

.threat .ladder-rung.checked {
  background: #f8f9fa;
  opacity: 0.7;
}

.threat .ladder-rung.highest-unchecked {
  border-color: var(--sof-accent);
  border-width: 2px;
  background: #e3f2fd;
}

.threat .ladder-rung-checkbox {
  width: 20px;
  height: 20px;
  cursor: pointer;
  flex-shrink: 0;
}

.threat .ladder-rung-aspect {
  flex: 1;
  padding: 4px 8px;
  border: 1px solid var(--sof-border);
  border-radius: 3px;
  min-width: 0;
}

.threat .ladder-rung-aspect.checked-aspect {
  text-decoration: line-through;
  color: #999;
}

/* Ladder rung value box */
.threat .ladder-rung-value-box {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  border: 2px solid var(--sof-border);
  border-radius: 3px;
  background: white;
  flex-shrink: 0;
}

/* Clickable ladder rung value box (replaces checkbox in play mode) */
.threat .ladder-rung-clickable {
  cursor: pointer;
  transition: all 0.2s;
}

.threat .ladder-rung-clickable:hover {
  border-color: var(--sof-accent);
  background: #f0f8ff;
}

.threat .ladder-rung.checked .ladder-rung-value-box {
  background: #ffebee;
  border-color: var(--sof-danger);
}

.threat .ladder-rung.checked .ladder-rung-clickable:hover {
  background: #ffcdd2;
}

.threat .ladder-rung-value-box .rung-value {
  font-size: 14px;
  font-weight: normal;
  color: var(--sof-secondary);
}

.threat .ladder-rung.checked .rung-value {
  color: var(--sof-danger);
  font-weight: bold;
  font-size: 18px;
}

/* Stress Track Row */
.threat .stress-track-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin: 8px 0;
  flex-wrap: wrap;
}

.threat .track-label-edit {
  min-width: 100px;
  max-width: 150px;
  padding: 4px 8px;
  font-weight: bold;
}

.threat .stress-boxes {
  display: flex;
  gap: 4px;
  flex-wrap: wrap;
}

/* Section Box - Container for each modular section */
.threat .section-box {
  background: white;
  border: 1px solid var(--sof-border);
  border-radius: 4px;
  padding: 12px;
  margin: 8px 0;
}

/* Visible sections in edit mode get a subtle green tint */
.threat .section-box.section-visible-in-edit {
  background: #f0f8f0;
  border-color: #c8e6c9;
}

/* Hidden sections in edit mode get a subtle gray tint */
.threat .section-box.section-hidden-in-edit {
  background: #f5f5f5;
  border-color: #e0e0e0;
}

/* Details Section - Rich text editor with extra space */
.threat .details-content {
  min-height: 220px;
  padding: 5px;
}

.threat .details-content .editor {
  min-height: 210px;
}

.threat .details-content .editor-content {
  min-height: 200px !important;
  max-height: 400px;
}

.threat .details-content .ProseMirror {
  min-height: 200px !important;
}

/* ===========================
   Named NPC Item Sheet
   =========================== */

.named-npc .sheet-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 15px;
  padding-bottom: 10px;
  border-bottom: 2px solid var(--sof-primary);
}

.named-npc .header-fields {
  flex: 1;
  margin-right: 15px;
}

.named-npc .name-row,
.named-npc .generation-row {
  display: flex;
  gap: 15px;
  margin-bottom: 10px;
}

.named-npc .name-field {
  flex: 1;
}

.named-npc .generation-field {
  flex: 0 0 auto;
  width: 80px;
}

.named-npc .generation-field input[type="number"] {
  width: 100%;
}

.named-npc .age-display {
  flex: 1;
}

.named-npc .field-label {
  display: block;
  font-weight: bold;
  margin-bottom: 3px;
  font-size: 12px;
  color: var(--sof-secondary);
}

.named-npc .age-value {
  padding: 6px 10px;
  background: var(--sof-light);
  border: 1px solid var(--sof-border);
  border-radius: 3px;
  font-weight: bold;
}

.named-npc .age-value.deceased {
  background: #ffebee;
  border-color: var(--sof-danger);
  color: var(--sof-danger);
}

.named-npc .aspect-box {
  margin-bottom: 15px;
}

.named-npc .aspect-box label {
  display: block;
  font-weight: bold;
  margin-bottom: 5px;
  color: var(--sof-primary);
}

.named-npc .skill-section {
  margin-bottom: 15px;
  padding: 10px;
  background: white;
  border: 1px solid var(--sof-border);
  border-radius: 4px;
}

.named-npc .skill-section.hidden-skill {
  opacity: 0.6;
}

.named-npc .subsection-header {
  font-weight: bold;
  font-size: 14px;
  color: white;
  background: var(--sof-primary);
  padding: 6px 10px;
  margin-bottom: 8px;
  border-radius: 3px;
}

.named-npc .skill-row {
  display: flex;
  gap: 15px;
  align-items: flex-end;
}

.named-npc .skill-row .roll-button {
  height: 32px;
  width: 32px;
  padding: 4px;
  flex-shrink: 0;
}

.named-npc .skill-name-field {
  flex: 2;
}

.named-npc .skill-value-field {
  flex: 1;
}

.named-npc .skill-name-field label,
.named-npc .skill-value-field label {
  display: block;
  font-weight: bold;
  font-size: 11px;
  margin-bottom: 3px;
  color: var(--sof-secondary);
}

/* NPC Age Track */
.named-npc .npc-age-track {
  margin-bottom: 15px;
}

.named-npc .age-track-table {
  background: white;
  border: 1px solid var(--sof-border);
  border-radius: 4px;
  overflow: hidden;
}

.named-npc .age-track-header {
  display: grid;
  grid-template-columns: 2fr 1fr;
  background: var(--sof-primary);
  color: white;
  font-weight: bold;
}

.named-npc .age-track-row {
  display: grid;
  grid-template-columns: 2fr 1fr;
  border-top: 1px solid var(--sof-border);
}

.named-npc .age-track-cell {
  padding: 8px 12px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.named-npc .age-track-cell.age-label {
  justify-content: flex-start;
  font-weight: bold;
}

.named-npc .age-track-cell.age-label.current-age {
  background: #e3f2fd;
  color: var(--sof-accent);
  font-weight: bold;
}

.named-npc .age-track-cell.age-label.passed-age {
  opacity: 0.6;
  font-style: italic;
}

.named-npc .age-scar {
  cursor: pointer;
}

.named-npc .age-scar.disabled-checkbox {
  opacity: 0.3;
  cursor: not-allowed;
}

.named-npc .description-field {
  margin-bottom: 15px;
}

.named-npc .description-field textarea {
  font-family: 'Signika', 'Palatino Linotype', serif;
  resize: vertical;
}

/* ===========================
   Registrar Actor Sheet
   =========================== */

.registrar .sheet-header {
  padding-bottom: 10px;
  margin-bottom: 15px;
  border-bottom: 2px solid var(--sof-primary);
  display: flex;
  flex-direction: column;
}

.registrar .header-fields {
  width: 100%;
}

.registrar .registrar-name-field {
  width: 100%;
}

.registrar .registrar-name-field label {
  display: block;
  font-weight: bold;
  margin-bottom: 5px;
  color: var(--sof-primary);
}

.registrar .registrar-name-field input {
  width: 100%;
}

.registrar .registrar-body {
  padding: 10px;
}

.registrar .registrar-notes-section {
  margin-top: 10px;
  padding: 0 10px 10px 10px;
  width: 100%;
}

.registrar .editor-container.registrar-notes {
  height: 100px !important;
  min-height: 100px !important;

  margin-bottom: 0;
  overflow: visible;
}

.registrar .editor-container.registrar-notes .editor {
  min-height: 180px !important;
}

.registrar .editor-container.registrar-notes .editor.tinymce {
  height: 180px !important;
  min-height: 180px !important;
  max-height: 180px !important;
}

.registrar .editor-container.registrar-notes .editor-content {
  height: 100% !important;
  min-height: 90px !important;
}

/* Target TinyMCE editor specifically - let it fill the parent */
.registrar .editor-container.registrar-notes .tox.tox-tinymce {
  height: 100% !important;
}

.registrar .editor-container.registrar-notes .tox-sidebar-wrap {
  height: 100% !important;
}

.registrar .editor-container.registrar-notes .tox-edit-area {
  height: 100% !important;
}

.registrar .editor-container.registrar-notes .tox-edit-area__iframe {
  height: 100% !important;
}

.registrar .registrar-notes.prosemirror {
  height: 100%;
}

/* When editing, expand the editor to fill available space */
.registrar .registrar-notes:has(.editor-content:focus),
.registrar .registrar-notes:has(.tox-edit-area) {
  height: auto !important;
  max-height: calc(100vh - 400px) !important;
  min-height: 200px !important;
}

.registrar .registrar-notes:has(.editor-content:focus) .editor,
.registrar .registrar-notes:has(.tox-edit-area) .editor {
  height: auto !important;
  max-height: none !important;
  min-height: 180px !important;
}

.registrar .npc-list {
  margin-bottom: 20px;
  min-height: 200px;
}

.registrar .items-list {
  list-style: none;
  margin: 0;
  padding: 0;
}

.registrar .npc-item {
  display: flex;
  align-items: center;
  padding: 8px;
  margin-bottom: 8px;
  background: white;
  border: 1px solid var(--sof-border);
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s, box-shadow 0.2s;
  width: 100%;
  box-sizing: border-box;
}

.registrar .npc-item:hover {
  background: #f8f9fa;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.registrar .npc-item.deceased {
  opacity: 0.6;
  background: #f5f5f5;
}

.registrar .npc-item.deceased:hover {
  background: #ebebeb;
}

.registrar .item-details {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
  min-width: 0;
}

.registrar .item-name {
  display: flex;
  flex-direction: column;
}

.registrar .item-name h4 {
  margin: 0 0 4px 0;
  font-size: 16px;
  color: var(--sof-primary);
}

.registrar .item-aspect {
  font-size: 13px;
  font-style: italic;
  color: var(--sof-secondary);
}

.registrar .item-info {
  display: flex;
  gap: 15px;
  align-items: center;
  font-size: 12px;
  flex-wrap: wrap;
}

.registrar .npc-age-status {
  padding: 2px 6px;
  background: #e3f2fd;
  border-radius: 3px;
  font-weight: bold;
  color: var(--sof-accent);
}

.registrar .npc-age-status.deceased {
  background: #ffebee;
  color: var(--sof-danger);
}

.registrar .npc-skill-info {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-shrink: 0;
}

.registrar .npc-skill-info .roll-button {
  width: 24px;
  height: 24px;
  padding: 4px;
  font-size: 12px;
  min-width: 24px;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

.registrar .skill-label {
  font-weight: bold;
  color: var(--sof-secondary);
  white-space: nowrap;
}

.registrar .item-controls {
  display: flex;
  gap: 8px;
  flex: 0 0 auto;
  margin-left: auto;
}

.registrar .item-control {
  padding: 4px 8px;
  background: transparent;
  border: 1px solid var(--sof-border);
  border-radius: 3px;
  cursor: pointer;
  transition: background-color 0.2s, border-color 0.2s;
  color: var(--sof-secondary);
}

.registrar .item-control:hover {
  background: var(--sof-accent);
  border-color: var(--sof-accent);
  color: white;
}

.registrar .item-control.item-delete:hover {
  background: var(--sof-danger);
  border-color: var(--sof-danger);
}

.registrar .empty-message {
  padding: 40px 20px;
  text-align: center;
  color: var(--sof-secondary);
  font-style: italic;
}

.registrar .empty-message p {
  margin: 0;
}

/* ===========================
   Named NPCs Tab - Shared Styles
   (for Colony, Faction-Scion, Threat)
   =========================== */

.colony .npc-list,
.faction-scion .npc-list,
.threat .npc-list {
  margin-bottom: 20px;
  min-height: 200px;
}

.colony .items-list,
.faction-scion .items-list,
.threat .items-list {
  list-style: none;
  margin: 0;
  padding: 0;
}

.colony .npc-item,
.faction-scion .npc-item,
.threat .npc-item {
  display: flex;
  align-items: center;
  padding: 8px;
  margin-bottom: 8px;
  background: white;
  border: 1px solid var(--sof-border);
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s, box-shadow 0.2s;
  width: 100%;
  box-sizing: border-box;
}

.colony .npc-item:hover,
.faction-scion .npc-item:hover,
.threat .npc-item:hover {
  background: #f8f9fa;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.colony .npc-item.deceased,
.faction-scion .npc-item.deceased,
.threat .npc-item.deceased {
  opacity: 0.6;
  background: #f5f5f5;
}

.colony .npc-item.deceased:hover,
.faction-scion .npc-item.deceased:hover,
.threat .npc-item.deceased:hover {
  background: #ebebeb;
}

.colony .item-details,
.faction-scion .item-details,
.threat .item-details {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
  min-width: 0;
}

.colony .item-name,
.faction-scion .item-name,
.threat .item-name {
  display: flex;
  flex-direction: column;
}

.colony .item-name h4,
.faction-scion .item-name h4,
.threat .item-name h4 {
  margin: 0 0 4px 0;
  font-size: 16px;
  color: var(--sof-primary);
}

.colony .item-aspect,
.faction-scion .item-aspect,
.threat .item-aspect {
  font-size: 13px;
  font-style: italic;
  color: var(--sof-secondary);
}

.colony .item-info,
.faction-scion .item-info,
.threat .item-info {
  display: flex;
  gap: 15px;
  align-items: center;
  font-size: 12px;
  flex-wrap: wrap;
}

.colony .npc-age-status,
.faction-scion .npc-age-status,
.threat .npc-age-status {
  padding: 2px 6px;
  background: #e3f2fd;
  border-radius: 3px;
  font-weight: bold;
  color: var(--sof-accent);
}

.colony .npc-age-status.deceased,
.faction-scion .npc-age-status.deceased,
.threat .npc-age-status.deceased {
  background: #ffebee;
  color: var(--sof-danger);
}

.colony .npc-skill-info,
.faction-scion .npc-skill-info,
.threat .npc-skill-info {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-shrink: 0;
}

.colony .npc-skill-info .roll-button,
.faction-scion .npc-skill-info .roll-button,
.threat .npc-skill-info .roll-button {
  width: 24px;
  height: 24px;
  padding: 4px;
  font-size: 12px;
  min-width: 24px;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

.colony .skill-label,
.faction-scion .skill-label,
.threat .skill-label {
  font-weight: bold;
  color: var(--sof-secondary);
  white-space: nowrap;
}

.colony .item-controls,
.faction-scion .item-controls,
.threat .item-controls {
  display: flex;
  gap: 8px;
  flex: 0 0 auto;
  margin-left: auto;
}

.colony .item-control,
.faction-scion .item-control,
.threat .item-control {
  padding: 4px 8px;
  background: transparent;
  border: 1px solid var(--sof-border);
  border-radius: 3px;
  cursor: pointer;
  transition: background-color 0.2s, border-color 0.2s;
  color: var(--sof-secondary);
}

.colony .item-control:hover,
.faction-scion .item-control:hover,
.threat .item-control:hover {
  background: var(--sof-accent);
  border-color: var(--sof-accent);
  color: white;
}

.colony .item-control.item-delete:hover,
.faction-scion .item-control.item-delete:hover,
.threat .item-control.item-delete:hover {
  background: var(--sof-danger);
  border-color: var(--sof-danger);
}

.colony .npcs-tab .empty-message,
.faction-scion .npcs-tab .empty-message,
.threat .npcs-tab .empty-message {
  padding: 40px 20px;
  text-align: center;
  color: var(--sof-secondary);
  font-style: italic;
}

.colony .npcs-tab .empty-message p,
.faction-scion .npcs-tab .empty-message p,
.threat .npcs-tab .empty-message p {
  margin: 0;
}

/* ===========================
   Extra Items Tab - Shared Styles
   (for Colony, Faction-Scion, Threat)
   =========================== */

.colony .extras-list,
.faction-scion .extras-list,
.threat .extras-list {
  margin-bottom: 20px;
  min-height: 200px;
}

.colony .extra button
.faction-scion button 
.threat .extra button {
  width: 35px;
}

.colony .extra-item,
.faction-scion .extra-item,
.threat .extra-item {
  display: flex;
  align-items: flex-start;
  padding: 10px;
  margin-bottom: 10px;
  background: white;
  border: 1px solid var(--sof-border);
  border-left: 5px solid var(--tint-color, var(--sof-border));
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s, box-shadow 0.2s;
  width: 100%;
  box-sizing: border-box;
  position: relative;
}

.colony .extra-item::before,
.faction-scion .extra-item::before,
.threat .extra-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--tint-color, transparent);
  opacity: 0.05;
  border-radius: 2px;
  pointer-events: none;
}

.colony .extra-item:hover,
.faction-scion .extra-item:hover,
.threat .extra-item:hover {
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}

.colony .extra-icon,
.faction-scion .extra-icon,
.threat .extra-icon {
  flex-shrink: 0;
  width: 40px;
  height: 40px;
  margin-right: 10px;
  border: 1px solid var(--sof-border);
  border-radius: 4px;
  background: black;
  overflow: hidden;
}

.colony .extra-icon img,
.faction-scion .extra-icon img,
.threat .extra-icon img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.colony .extra-content,
.faction-scion .extra-content,
.threat .extra-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 6px;
  min-width: 0;
}

.colony .extra-aspect-row,
.faction-scion .extra-aspect-row,
.threat .extra-aspect-row {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.colony .extra-aspect-label,
.faction-scion .extra-aspect-label,
.threat .extra-aspect-label {
  font-size: 11px;
  font-weight: bold;
  color: var(--sof-secondary);
  text-transform: uppercase;
}

.colony .extra-aspect-value,
.faction-scion .extra-aspect-value,
.threat .extra-aspect-value {
  font-size: 14px;
  font-style: italic;
  color: var(--sof-primary);
  font-weight: 500;
}

.colony .extra-invokes,
.faction-scion .extra-invokes,
.threat .extra-invokes {
  display: flex;
  gap: 4px;
  align-items: center;
  flex-wrap: wrap;
}

/* Override existing invoke-checkbox styles */
.colony .invoke-checkbox,
.faction-scion .invoke-checkbox,
.threat .invoke-checkbox {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  width: 20px;
  height: 20px;
  border: 2px solid var(--sof-success);
  border-radius: 50%;
  position: relative;
  cursor: pointer;
  background: var(--sof-success);
  transition: all 0.2s ease;
}

/* Hover effect */
.colony .invoke-checkbox:hover,
.faction-scion .invoke-checkbox:hover,
.threat .invoke-checkbox:hover {
  box-shadow: 0 0 5px rgba(39, 174, 96, 0.5);
}

/* Plus symbol */
.colony .invoke-checkbox::before,
.faction-scion .invoke-checkbox::before,
.threat .invoke-checkbox::before {
  content: '+';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 16px;
  font-weight: bold;
  color: white;
  line-height: 1;
  text-align: center;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  transition: all 0.2s ease;
}

/* Checked state */
.colony .invoke-checkbox:checked,
.faction-scion .invoke-checkbox:checked,
.threat .invoke-checkbox:checked {
  background: white;
  border-color: var(--sof-border);
}

.colony .invoke-checkbox:checked::before,
.faction-scion .invoke-checkbox:checked::before,
.threat .invoke-checkbox:checked::before {
  color: var(--sof-border);
}


/* Extra Ladder Display - Vertical Layout */
.colony .extra-ladder-display,
.faction-scion .extra-ladder-display,
.threat .extra-ladder-display {
  margin-top: 8px;
}

.colony .ladder-label,
.faction-scion .ladder-label,
.threat .ladder-label {
  font-weight: bold;
  color: var(--sof-primary);
  margin-bottom: 6px;
  font-size: 13px;
}

.colony .ladder-rungs-vertical,
.faction-scion .ladder-rungs-vertical,
.threat .ladder-rungs-vertical {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

/* Embedded Ladder Rungs */
.colony .ladder-rung-embedded,
.faction-scion .ladder-rung-embedded,
.threat .ladder-rung-embedded {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 4px;
  background: white;
  border: 1px solid var(--sof-border);
  border-radius: 3px;
  transition: all 0.2s;
}

.colony .ladder-rung-embedded.checked,
.faction-scion .ladder-rung-embedded.checked,
.threat .ladder-rung-embedded.checked {
  background: #f8f9fa;
  opacity: 0.7;
}

.colony .ladder-rung-embedded.highest-unchecked,
.faction-scion .ladder-rung-embedded.highest-unchecked,
.threat .ladder-rung-embedded.highest-unchecked {
  border-color: var(--sof-accent);
  border-width: 2px;
  background: #e3f2fd;
}

/* Embedded Ladder Rung Value Box (clickable checkbox replacement) */
.colony .ladder-rung-embedded .ladder-rung-value-box,
.faction-scion .ladder-rung-embedded .ladder-rung-value-box,
.threat .ladder-rung-embedded .ladder-rung-value-box {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  border: 2px solid var(--sof-border);
  border-radius: 3px;
  background: white;
  flex-shrink: 0;
}

.colony .ladder-rung-embedded .ladder-rung-clickable,
.faction-scion .ladder-rung-embedded .ladder-rung-clickable,
.threat .ladder-rung-embedded .ladder-rung-clickable {
  cursor: pointer;
  transition: all 0.2s;
}

.colony .ladder-rung-embedded .ladder-rung-clickable:hover,
.faction-scion .ladder-rung-embedded .ladder-rung-clickable:hover,
.threat .ladder-rung-embedded .ladder-rung-clickable:hover {
  border-color: var(--sof-accent);
  background: #f0f8ff;
}

.colony .ladder-rung-embedded.checked .ladder-rung-value-box,
.faction-scion .ladder-rung-embedded.checked .ladder-rung-value-box,
.threat .ladder-rung-embedded.checked .ladder-rung-value-box {
  background: #ffebee;
  border-color: var(--sof-danger);
}

.colony .ladder-rung-embedded.checked .ladder-rung-clickable:hover,
.faction-scion .ladder-rung-embedded.checked .ladder-rung-clickable:hover,
.threat .ladder-rung-embedded.checked .ladder-rung-clickable:hover {
  background: #ffcdd2;
}

.colony .ladder-rung-embedded .rung-value,
.faction-scion .ladder-rung-embedded .rung-value,
.threat .ladder-rung-embedded .rung-value {
  font-size: 13px;
  font-weight: normal;
  color: var(--sof-secondary);
  pointer-events: none;
}

.colony .ladder-rung-embedded.checked .rung-value,
.faction-scion .ladder-rung-embedded.checked .rung-value,
.threat .ladder-rung-embedded.checked .rung-value {
  color: var(--sof-danger);
  font-weight: bold;
  font-size: 16px;
}

/* Embedded Ladder Rung Aspect Text */
.colony .ladder-rung-aspect-embedded,
.faction-scion .ladder-rung-aspect-embedded,
.threat .ladder-rung-aspect-embedded {
  flex: 1;
  font-size: 13px;
  color: var(--sof-text);
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.colony .ladder-rung-aspect-embedded.checked-aspect,
.faction-scion .ladder-rung-aspect-embedded.checked-aspect,
.threat .ladder-rung-aspect-embedded.checked-aspect {
  text-decoration: line-through;
  color: #999;
}

.colony .extra-skill-display,
.faction-scion .extra-skill-display,
.threat .extra-skill-display {
  display: flex;
  align-items: center;
  gap: 6px;
}

.colony .extra-skill-display .roll-button,
.faction-scion .extra-skill-display .roll-button,
.threat .extra-skill-display .roll-button {
  width: 24px;
  height: 24px;
  padding: 4px;
  font-size: 12px;
  min-width: 24px;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--sof-accent);
  color: white;
  border: none;
  border-radius: 3px;
  cursor: pointer;
  transition: background-color 0.2s;
}

.colony .extra-skill-display .roll-button:hover,
.faction-scion .extra-skill-display .roll-button:hover,
.threat .extra-skill-display .roll-button:hover {
  background: var(--sof-primary);
}

.colony .extra-skill-info,
.faction-scion .extra-skill-info,
.threat .extra-skill-info {
  display: flex;
  align-items: center;
  gap: 4px;
}

.colony .extra-skill-name,
.faction-scion .extra-skill-name,
.threat .extra-skill-name {
  font-weight: bold;
  color: var(--sof-secondary);
}

.colony .extra-skill-value,
.faction-scion .extra-skill-value,
.threat .extra-skill-value {
  color: var(--sof-accent);
  font-weight: bold;
}

.colony .extra-track-display,
.faction-scion .extra-track-display,
.threat .extra-track-display {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.colony .extra-track-label,
.faction-scion .extra-track-label,
.threat .extra-track-label {
  font-size: 11px;
  font-weight: bold;
  color: var(--sof-secondary);
  text-transform: uppercase;
}

.colony .extra-track-boxes,
.faction-scion .extra-track-boxes,
.threat .extra-track-boxes {
  display: flex;
  gap: 3px;
  align-items: center;
  flex-wrap: wrap;
}

.colony .track-box-wrapper,
.faction-scion .track-box-wrapper,
.threat .track-box-wrapper {
  position: relative;
  display: inline-block;
  width: 30px;
  height: 30px;
  line-height: 30px;
  text-align: center;
  border: 2px solid var(--sof-border);
  border-radius: 3px;
  margin: 0 2px;
  cursor: pointer;
  background: white;
  font-size: 14px;
  color: var(--sof-secondary);
  transition: all 0.2s;
}

.colony .track-box-wrapper:hover,
.faction-scion .track-box-wrapper:hover,
.threat .track-box-wrapper:hover {
  border-color: var(--sof-primary);
  background: rgba(var(--sof-primary-rgb), 0.05);
}

.colony .track-box-wrapper.checked,
.faction-scion .track-box-wrapper.checked,
.threat .track-box-wrapper.checked {
  background: #ffebee;
  border-color: var(--sof-danger);
}

.colony .track-box-wrapper .track-value,
.faction-scion .track-box-wrapper .track-value,
.threat .track-box-wrapper .track-value {
  display: block;
  font-weight: normal;
  color: var(--sof-secondary);
  pointer-events: none;
}

.colony .track-box-wrapper.checked .track-value,
.faction-scion .track-box-wrapper.checked .track-value,
.threat .track-box-wrapper.checked .track-value {
  color: var(--sof-danger);
  font-weight: bold;
}

/* Legacy checkbox styling (for item sheets if needed) */
.colony .track-checkbox,
.faction-scion .track-checkbox,
.threat .track-checkbox {
  appearance: none;
  width: 20px;
  height: 20px;
  border: 2px solid var(--sof-border);
  border-radius: 2px;
  cursor: pointer;
  background: white;
  transition: all 0.2s;
}

.colony .track-checkbox:checked,
.faction-scion .track-checkbox:checked,
.threat .track-checkbox:checked {
  background: var(--sof-primary);
  border-color: var(--sof-primary);
}

.colony .track-checkbox:checked::after,
.faction-scion .track-checkbox:checked::after,
.threat .track-checkbox:checked::after {
  content: 'X';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: white;
  font-weight: bold;
  font-size: 12px;
  line-height: 1;
}

.colony .track-box-label,
.faction-scion .track-box-label,
.threat .track-box-label {
  position: absolute;
  bottom: -2px;
  right: -2px;
  font-size: 9px;
  font-weight: bold;
  color: var(--sof-secondary);
  background: white;
  border: 1px solid var(--sof-border);
  border-radius: 2px;
  padding: 0 2px;
  line-height: 1.2;
}

.colony .extras-tab .empty-message,
.faction-scion .extras-tab .empty-message,
.threat .extras-tab .empty-message {
  padding: 40px 20px;
  text-align: center;
  color: var(--sof-secondary);
  font-style: italic;
}

.colony .extras-tab .empty-message p,
.faction-scion .extras-tab .empty-message p,
.threat .extras-tab .empty-message p {
  margin: 0;
}

/* ========================================
   STUNT CHAT CARDS
   ======================================== */

.stunt-chat-card {
  border-radius: 4px;
  padding: 12px;
  margin: 8px 0;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.stunt-chat-card.scope-faction {
  background: #f8f9fa;
  border-left: 4px solid var(--sof-primary);
}

.stunt-chat-card.scope-scion {
  background: #e3f2fd;
  border-left: 4px solid var(--sof-accent);
}

.stunt-chat-card.scope-other {
  background: #f8f9fa;
  border-left: 4px solid #6c757d;
}

.stunt-chat-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
  padding-bottom: 8px;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.stunt-chat-header .stunt-icon {
  width: 32px;
  height: 32px;
  border-radius: 2px;
  border: 1px solid rgba(0, 0, 0, 0.2);
  object-fit: cover;
}

.stunt-chat-header .stunt-name {
  margin: 0;
  font-size: 16px;
  font-weight: 600;
  color: var(--sof-primary);
  flex: 1;
}

.stunt-chat-content {
  font-size: 14px;
  line-height: 1.6;
  color: #333;
}

.stunt-chat-content p {
  margin: 0;
}

.stunt-chat-content em {
  color: var(--sof-secondary);
}

/* ===========================
   Simple Aspect Actor Sheet
   =========================== */

.simple-aspect .sheet-header {
  padding: 15px;
  border-bottom: 2px solid var(--sof-primary);
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.simple-aspect .header-fields {
  display: flex;
  flex-direction: row;
  gap: 15px;
  align-items: flex-start;
}

.simple-aspect .aspect-name-field {
  flex: 1;
}

.simple-aspect .aspect-name-field label {
  display: block;
  font-weight: bold;
  margin-bottom: 5px;
  color: var(--sof-primary);
}

.simple-aspect .aspect-name-field input {
  width: 100%;
  font-size: 16px;
  padding: 5px;
}

.simple-aspect .aspect-icon-field {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 5px;
}

.simple-aspect .aspect-icon-field label {
  font-weight: bold;
  color: var(--sof-primary);
}

.simple-aspect .profile-img {
  position: relative;
  border: 2px solid var(--sof-primary);
  border-radius: 5px;
  overflow: hidden;
  cursor: pointer;
  transition: border-color 0.2s;
}

.simple-aspect .profile-img:hover {
  border-color: var(--sof-secondary);
}

.simple-aspect .profile-img img {
  display: block;
  object-fit: cover;
}

.simple-aspect .simple-aspect-body {
  padding: 20px;
}

.simple-aspect .free-invokes-section {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.simple-aspect .section-header {
  font-weight: bold;
  font-size: 14px;
  color: var(--sof-primary);
  text-transform: uppercase;
  margin-bottom: 5px;
}

.simple-aspect .invoke-controls {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
}

.simple-aspect .invoke-controls button {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: var(--sof-primary);
  color: white;
  border: none;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
}

.simple-aspect .invoke-controls button:hover {
  background: var(--sof-secondary);
  transform: scale(1.1);
}

.simple-aspect .invoke-controls button:active {
  transform: scale(0.95);
}

.simple-aspect .invoke-display {
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 24px;
  font-weight: bold;
  color: var(--sof-primary);
}

.simple-aspect .invoke-display input[type="number"] {
  width: 60px;
  text-align: center;
  font-size: 24px;
  font-weight: bold;
  border: 2px solid var(--sof-primary);
  border-radius: 5px;
  padding: 5px;
}

.simple-aspect .invoke-separator {
  color: var(--sof-primary);
  font-size: 24px;
  font-weight: bold;
}

/* ===== THREAT SHARE TO CHAT ===== */

/* Header buttons container */
.threat .header-buttons {
  display: flex;
  gap: 10px;
  align-items: center;
}

/* Share to Chat button */
.threat .share-to-chat {
  background-color: var(--sof-accent);
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 13px;
  font-weight: bold;
  transition: background-color 0.2s;
}

.threat .share-to-chat:hover {
  background-color: #cc8800;
}

.threat .share-to-chat i {
  margin-right: 5px;
}

/* Threat Share Chat Card */
.threat-share-card {
  background: linear-gradient(to bottom, #2a2a2a 0%, #1a1a1a 100%);
  border: 2px solid var(--sof-primary);
  border-radius: 8px;
  padding: 15px;
  color: #e0e0e0;
  font-family: var(--font-primary);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.threat-share-card .threat-header {
  background-color: var(--sof-primary);
  color: white;
  padding: 10px;
  margin: -15px -15px 15px -15px;
  border-radius: 6px 6px 0 0;
  border-bottom: 2px solid var(--sof-accent);
  display: flex;
  align-items: center;
  gap: 12px;
}

.threat-share-card .threat-portrait {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  border: 2px solid var(--sof-accent);
  object-fit: cover;
  flex-shrink: 0;
}

.threat-share-card .threat-header h3 {
  margin: 0;
  font-size: 18px;
  font-weight: bold;
  color: white;
  flex-grow: 1;
}

.threat-share-card .threat-section {
  margin-bottom: 12px;
  padding-bottom: 12px;
  border-bottom: 1px solid #444;
}

.threat-share-card .threat-section:last-child {
  border-bottom: none;
  margin-bottom: 0;
  padding-bottom: 0;
}

.threat-share-card .section-title {
  font-weight: bold;
  color: var(--sof-accent);
  font-size: 14px;
  margin-bottom: 6px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.threat-share-card .aspect-entry,
.threat-share-card .consequence-entry,
.threat-share-card .ladder-entry,
.threat-share-card .age-entry {
  margin-bottom: 6px;
  padding-left: 10px;
  line-height: 1.4;
}

.threat-share-card .aspect-entry:last-child,
.threat-share-card .consequence-entry:last-child,
.threat-share-card .ladder-entry:last-child,
.threat-share-card .age-entry:last-child {
  margin-bottom: 0;
}

.threat-share-card .free-invoke-badge {
  background-color: var(--sof-accent);
  color: white;
  padding: 2px 6px;
  border-radius: 3px;
  font-size: 11px;
  font-weight: bold;
  margin-left: 5px;
  text-transform: uppercase;
}

.threat-share-card .rung-info {
  color: #999;
  font-size: 12px;
  font-style: italic;
}

/* ===== NAMED NPC SHARE TO CHAT ===== */

/* Share to Chat button on NPC sheet */
.named-npc .name-row {
  display: flex;
  gap: 10px;
  align-items: flex-end;
}

.named-npc .name-field {
  flex-grow: 1;
}

.named-npc .share-to-chat {
  background-color: var(--sof-accent);
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 13px;
  font-weight: bold;
  transition: background-color 0.2s;
  margin-bottom: 2px;
}

.named-npc .share-to-chat:hover {
  background-color: #cc8800;
}

.named-npc .share-to-chat i {
  margin-right: 5px;
}

/* NPC Share Chat Card */
.npc-share-card {
  background: linear-gradient(to bottom, #2a2a2a 0%, #1a1a1a 100%);
  border: 2px solid var(--sof-primary);
  border-radius: 8px;
  padding: 15px;
  color: #e0e0e0;
  font-family: var(--font-primary);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  max-width: 400px;
}

.npc-share-card .npc-header {
  background-color: var(--sof-primary);
  color: white;
  padding: 10px;
  margin: -15px -15px 15px -15px;
  border-radius: 6px 6px 0 0;
  border-bottom: 2px solid var(--sof-accent);
}

.npc-share-card .npc-header h3 {
  margin: 0;
  font-size: 16px;
  font-weight: bold;
  text-align: center;
  color: white;
}

.npc-share-card .npc-section {
  margin-bottom: 12px;
  padding-bottom: 12px;
  border-bottom: 1px solid #444;
}

.npc-share-card .npc-section:last-child {
  border-bottom: none;
  margin-bottom: 0;
  padding-bottom: 0;
}

.npc-share-card .section-title {
  font-weight: bold;
  color: var(--sof-accent);
  font-size: 13px;
  margin-bottom: 6px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.npc-share-card .aspect-entry,
.npc-share-card .skill-entry,
.npc-share-card .age-entry {
  padding-left: 10px;
  line-height: 1.4;
}

.npc-share-card .age-entry.deceased {
  color: #ff6b6b;
  font-weight: bold;
}
